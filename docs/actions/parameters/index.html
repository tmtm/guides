<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Actions: Parameters | Hanami Guides" />

    <meta property="og:url"          content="https://tmtm.github.io/hanami-guides/actions/parameters/" />
    <meta property="og:type"         content="article" />
    <meta property="og:locale"       content="en_US" />
    <meta property="og:site_name"    content="Hanami Guides" />
    <meta property="og:title"        content="Actions: Parameters | Hanami Guides" />
    <meta property="og:description"  content="Actions: Parameters | Hanami Guides" />
    <meta property="og:image"        content="https://tmtm.github.io/assets/img/brand/hanami-guides-social.png" />
    <meta property="og:image:type"   content="image/png" />
    <meta property="og:image:width"  content="2968" />
    <meta property="og:image:height" content="2968" />
    <meta property="og:image:alt"    content="" />

    <meta name="twitter:card"        content="summary" />
    <meta name="twitter:site"        content="@hanamirb" />
    <meta name="twitter:creator"     content="@hanamirb" />
    <meta name="twitter:title"       content="Actions: Parameters | Hanami Guides" />
    <meta name="twitter:description" content="Actions: Parameters | Hanami Guides" />
    <meta name="twitter:image"       content="https://tmtm.github.io/assets/img/brand/hanami-guides-social.png" />

    <title>Actions: Parameters | Hanami Guides</title>

    <meta name="author" content="Hanami team">
    <meta name="keywords" content="hanami,hanamirb,hanami guides,documentation,lotus,lotusrb,web,framework,ruby,open source,oss,os,software,free,free software,architecture,fast,lightweight,testing,tdd,bdd,test driven development,behaviour driven development,full stack,mvc,model view object,pattern,patterns,design patterns,oop,object oriented programming,testability,http,https,routing,router,http router,restful,resource,resources,convention,controller,models,repository,query,sql,interactors,two-step view,view,template,presenters,render,rendering,helpers,erb,haml,tilt,json,xml,yaml,yml,framwork,framewrok,riby,free sowftare" />
    
    <link rel="shortcut icon" href="/hanami-guides/assets/img/brand/favicon.ico">
    
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    
    <link href="/hanami-guides/assets/vendor/nucleo/css/nucleo.css" rel="stylesheet">
    <link href="/hanami-guides/assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    
    <link type="text/css" href="/hanami-guides/assets/css/argon.css?v=1.0.1" rel="stylesheet">
    
    <link type="text/css" href="/hanami-guides/assets/css/docs.min.css" rel="stylesheet">
    
    <link type="text/css" href="/hanami-guides/assets/css/theme.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  </head>
  <body data-spy="scroll" data-target="#secondary-navigation" data-offset="50">
    <header class="navbar navbar-expand navbar-dark flex-row align-items-md-center ct-navbar">
      <a class="navbar-brand mr-0 mr-md-2" href="/hanami-guides/" aria-label="Bootstrap">
      <img src="/hanami-guides/assets/img/brand/white.png" alt="Hanami guides logo">
    </a>
    <ul class="navbar-nav flex-row mr-auto ml-4 d-none d-md-flex">
      <li class="nav-item">
        <form>
          <input type="text" placeholder="Search" class="form-control" id="search-input" />
        </form>
      </li>
    </ul>
    <div class="d-none d-sm-block ml-auto">
      <ul class="navbar-nav ct-navbar-nav flex-row align-items-center">
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="http://hanamirb.org" target="_blank" title="Hanami website">
            <i class="ni ni-world"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://github.com/hanami/guides/edit//content/actions/parameters.md" target="_blank" title="Edit this page">
            <i class="fa fa-pencil-square-o"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://github.com/hanami/hanami" target="_blank" title="Star Hanami on GitHub">
            <i class="fa fa-github"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://twitter.com/hanamirb" target="_blank" title="Follow Hanami on Twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://www.facebook.com/hanamirb" target="_blank" title="Like Hanami on Facebook">
            <i class="fa fa-facebook-square"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://www.instagram.com/hanamirb" target="_blank" title="Follow Hanami on Instagram">
            <i class="fa fa-instagram"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="http://chat.hanamirb.org/" target="_blank" title="Hanami chat">
            <i class="ni ni-chat-round"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link nav-link-icon" href="https://github.com/hanami/guides/releases" target="_blank" title="Download Hanami Guides for offline usage">
            <i class="fa fa-cloud-download"></i>
          </a>
        </li>
        <li class="nav-item">
          <span class="badge badge-pill badge-primary">v1.3.1</span>
        </li>
      </ul>
    </div>
  </header>
  <div class="container-fluid">
    <div class="row flex-xl-nowrap">
      <div class="col-12 col-md-3 col-xl-2 ct-sidebar">
        <nav class="collapse ct-links" id="ct-docs-nav">
          
          <div class="ct-toc-item active">
          
          
            <span class="ct-toc-link">Introduction</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/introduction/getting-started/">はじめに</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Architecture</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/architecture/overview/">概要</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/architecture/interactors/">インタラクター</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Projects</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/projects/code-reloading/">コードのリロード</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/rake/">Rakeタスク</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/logging/">ロギング</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/initializers/">Initializers</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/rack-middleware/">Rack Middleware</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/security/">Project Security</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/http2-early-hints/">HTTP/2 Early Hints</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/projects/selectively-boot-apps/">Selectively boot apps</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Routing</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/routing/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/routing/basic-usage/">Basic Usage</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/routing/restful-resources/">RESTful Resource(s)</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/routing/testing/">Testing</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Actions</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/actions/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/basic-usage/">Basic Usage</a>
              </li>
            
              
              <li class="active ct-sidenav-active">
              
                <a href="/hanami-guides/actions/parameters/">Parameters</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/request-and-response/">Request &amp; Response</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/exposures/">Exposures</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/rack-integration/">Rack Integration</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/mime-types/">MIME Types</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/cookies/">Cookies</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/sessions/">Sessions</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/exception-handling/">Exception Handling</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/control-flow/">Control Flow</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/http-caching/">HTTP Caching</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/share-code/">Share Code</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/actions/testing/">Testing</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Views</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/views/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/basic-usage/">Basic Usage</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/templates/">Templates</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/mime-types/">MIME Types</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/layouts/">Layouts</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/custom-error-pages/">Custom Error Pages</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/share-code/">Share Code</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/views/testing/">Testing</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Models</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/models/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/models/database-configuration/">Database Configuration</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/models/use-your-own-orm/">Use Your Own ORM</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Repositories</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/repositories/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/repositories/sql-queries/">SQL Queries</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/repositories/postgresql/">PostgreSQL</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Entities</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/entities/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/entities/custom-schema/">Custom Schema</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/entities/data-types/">Data Types</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Associations</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/associations/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/associations/has-many/">Has Many</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/associations/belongs-to/">Belongs To</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/associations/has-one/">Has One</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/associations/has-many-through/">Has Many Through</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Migrations</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/migrations/overview/">Migrations</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/migrations/create-table/">Create Table</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/migrations/alter-table/">Alter Table</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Validations</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/validations/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/validations/boolean-logic/">Boolean Logic</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/validations/custom-predicates/">Custom Predicates</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/validations/advanced-usage/">Advanced Usage</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Helpers</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/helpers/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/html5/">HTML5</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/forms/">Forms</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/routing/">Routing</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/assets/">Assets</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/links/">Links</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/escape/">Markup Escape</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/numbers/">Numbers</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/helpers/custom-helpers/">Custom Helpers</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Mailers</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/mailers/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/mailers/basic-usage/">Basic Usage</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/mailers/templates/">Templates</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/mailers/delivery/">Delivery</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/mailers/share-code/">Share Code</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/mailers/testing/">Testing</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Assets</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/assets/overview/">Overview</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/assets/preprocessors/">Preprocessors</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/assets/compressors/">Compressors</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/assets/content-delivery-network/">Content Delivery Network (CDN)</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/assets/use-your-own-assets-management-tool/">Use Your Own Assets Management</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Command Line</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/command-line/project/">Project</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/generators/">Generators</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/destroy/">Destroy</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/database/">Database</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/assets/">Assets</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/routes/">Routes</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/version/">Version</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/command-line/plugins/">Plugins</a>
              </li>
            
            </ul>
          
          
            <span class="ct-toc-link">Upgrade Notes</span>
            <ul class="nav ct-sidenav">
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v060/">v0.6.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v070/">v0.7.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v080/">v0.8.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v090/">v0.9.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v100/">v1.0.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v110/">v1.1.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v120/">v1.2.0</a>
              </li>
            
              
              <li>
              
                <a href="/hanami-guides/upgrade-notes/v130/">v1.3.0</a>
              </li>
            
            </ul>
          
          </div>
        </nav>
      </div>
      <div class="d-none d-xl-block col-xl-2 ct-toc">
        <ul class="section-nav" id="secondary-navigation">
        
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#sources" class="nav-link">Sources</a>
          </li>
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#access" class="nav-link">Access</a>
          </li>
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#whitelisting" class="nav-link">Whitelisting</a>
          </li>
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#validations-coercion" class="nav-link">Validations &amp; Coercion</a>
          </li>
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#concrete-classes" class="nav-link">Concrete Classes</a>
          </li>
        
          
          
          <li class="toc-entry toc-h2">
            <a href="#body-parsers" class="nav-link">Body Parsers</a>
          </li>
        
        </ul>
      </div>
      <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 ct-content">
        <div class="ct-page-title">
          <h1 class="ct-title" id="content">Actions: Parameters</h1>
          <div class="avatar-group mt-3">
          </div>
        </div>
        <hr>
        

<p>Parameters are taken from the Rack env and passed as an argument to <code>#call</code>.
They are similar to a Ruby <code>Hash</code>, but they offer an expanded set of features.</p>

<h2 id="sources">Sources</h2>

<p>Params can come from:</p>

<ul>
<li><a href="/routing/basic-usage">Router variables</a> (eg. <code>/books/:id</code>)</li>
<li>Query string (eg. <code>/books?title=Hanami</code>)</li>
<li>Request body (eg. a <code>POST</code> request to <code>/books</code>)</li>
</ul>

<h2 id="access">Access</h2>

<p>To access the value of a param, we can use the <em>subscriber operator</em> <code>#[]</code>.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/dashboard/index.rb</span>
<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Dashboard</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">Index</span>
        <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>

        <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
          <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">body</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Query string: </span><span style="color:#d88200">#{</span> <span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:q</span><span style="color:#f92672">]</span> <span style="color:#d88200">}</span><span style="color:#d88200">&#34;</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>If we visit <code>/dashboard?q=foo</code>, we should see <code>Query string: foo</code>.</p>

<h3 id="symbol-access">Symbol Access</h3>

<p>Params and nested params can be referenced <strong>only</strong> via symbols.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:q</span><span style="color:#f92672">]</span>
<span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:book</span><span style="color:#f92672">][</span><span style="color:#d88200">:title</span><span style="color:#f92672">]</span></code></pre></div>
<p>Now, what happens if the parameter <code>:book</code> is missing from the request?
Because <code>params[:book]</code> is <code>nil</code>, we can&rsquo;t access <code>:title</code>.
In this case Ruby will raise a <code>NoMethodError</code>.</p>

<p>We have a safe solution for our problem: <code>#get</code>.
It accepts a list of symbols, where each symbol represents a level in our nested structure.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">get</span><span style="color:#111">(</span><span style="color:#d88200">:book</span><span style="color:#111">,</span> <span style="color:#d88200">:title</span><span style="color:#111">)</span>             <span style="color:#75715e"># =&gt; &#34;Hanami&#34;</span>
<span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">get</span><span style="color:#111">(</span><span style="color:#d88200">:unknown</span><span style="color:#111">,</span> <span style="color:#d88200">:nested</span><span style="color:#111">,</span> <span style="color:#d88200">:param</span><span style="color:#111">)</span> <span style="color:#75715e"># =&gt; nil instead of NoMethodError</span></code></pre></div>
<h2 id="whitelisting">Whitelisting</h2>

<p>In order to show how whitelisting works, let&rsquo;s create a new action:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">bundle <span style="color:#111">exec</span> hanami generate action web signup#create</code></pre></div>
<p>We want to provide self-registration for our users.
We build a HTML form which posts to an action that accepts the payload and stores it in the <code>users</code> table.
That table has a boolean column <code>admin</code> to indicate whether a person has administration permissions.</p>

<p>A malicious user can exploit this scenario by sending this extra parameter to our application, thereby making themselves an administrator.</p>

<p>We can easily fix this problem by filtering the allowed parameters that are permitted inside our application.
Please always remember that <strong>params represent untrusted input</strong>.</p>

<p>We use <code>.params</code> to map the structure of the (nested) parameters.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/signup/create.rb</span>
<span style="color:#00a8c8">module</span> <span style="color:#111">Web::Controllers::Signup</span>
  <span style="color:#00a8c8">class</span> <span style="color:#75af00">Create</span>
    <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>

    <span style="color:#111">params</span> <span style="color:#00a8c8">do</span>
      <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:email</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span>
      <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:password</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span>

      <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:address</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">schema</span> <span style="color:#00a8c8">do</span>
        <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:country</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>

    <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
      <span style="color:#111">puts</span> <span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:email</span><span style="color:#f92672">]</span>             <span style="color:#75715e"># =&gt; &#34;alice@example.org&#34;</span>
      <span style="color:#111">puts</span> <span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:password</span><span style="color:#f92672">]</span>          <span style="color:#75715e"># =&gt; &#34;secret&#34;</span>
      <span style="color:#111">puts</span> <span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:address</span><span style="color:#f92672">][</span><span style="color:#d88200">:country</span><span style="color:#f92672">]</span> <span style="color:#75715e"># =&gt; &#34;Italy&#34;</span>

      <span style="color:#111">puts</span> <span style="color:#111">params</span><span style="color:#f92672">[</span><span style="color:#d88200">:admin</span><span style="color:#f92672">]</span>             <span style="color:#75715e"># =&gt; nil</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>Even if <code>admin</code> is sent inside the body of the request, it isn&rsquo;t accessible from <code>params</code>.</p>

<h2 id="validations-coercion">Validations &amp; Coercion</h2>

<h3 id="use-cases">Use Cases</h3>

<p>In our example (called <em>&ldquo;Signup&rdquo;</em>), we want to make <code>password</code> a required param.</p>

<p>Imagine we introduce a second feature: <em>&ldquo;Invitations&rdquo;</em>.
An existing user can ask someone to join.
Because the invitee will decide a password later on, we want to persist that <code>User</code> record without that value.</p>

<p>If we put <code>password</code> validation in <code>User</code>, we need to handle these two use cases with a conditional.
But in the long term this approach is painful from a maintenance perspective.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># Example of poor style for validations</span>
<span style="color:#00a8c8">class</span> <span style="color:#75af00">User</span>
  <span style="color:#111">attribute</span> <span style="color:#d88200">:password</span><span style="color:#111">,</span> <span style="color:#d88200">presence</span><span style="color:#111">:</span> <span style="color:#111">{</span> <span style="color:#00a8c8">if</span><span style="color:#111">:</span> <span style="color:#d88200">:password_required?</span> <span style="color:#111">}</span>

  <span style="color:#00a8c8">private</span>
  <span style="color:#00a8c8">def</span> <span style="color:#75af00">password_required?</span>
     <span style="color:#f92672">!</span><span style="color:#111">invited_user?</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#111">admin_password_reset?</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>We can see validations as the set of rules for data correctness that we want for <strong>a specific use case</strong>.
For us, a <code>User</code> can be persisted with or without a password, <strong>depending on the workflow</strong> and the route through
which the <code>User</code> is persisted.</p>

<h3 id="boundaries">Boundaries</h3>

<p>The second important aspect is that we use validations to prevent invalid inputs to propagate in our system.
In an MVC architecture, the model layer is the <strong>farthest</strong> from the input.
It&rsquo;s expensive to check the data right before we create a record in the database.</p>

<p>If we <strong>consider correct data as a precondition</strong> before starting our workflow, we should stop unacceptable inputs as soon as possible.</p>

<p>Think of the following method.
We don&rsquo;t want to continue if the data is invalid.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#00a8c8">def</span> <span style="color:#75af00">expensive_computation</span><span style="color:#111">(</span><span style="color:#111">argument</span><span style="color:#111">)</span>
  <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">if</span> <span style="color:#111">argument</span><span style="color:#f92672">.</span><span style="color:#111">nil?</span>
  <span style="color:#75715e"># ...</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<h3 id="usage">Usage</h3>

<p>We can coerce the Ruby type, validate if a param is required, determine if it is within a range of values, etc..</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/signup/create.rb</span>
<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Signup</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">Create</span>
        <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>
        <span style="color:#00a8c8">MEGABYTE</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>

        <span style="color:#111">params</span> <span style="color:#00a8c8">do</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:name</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">)</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:email</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">,</span> <span style="color:#111">format</span><span style="color:#d88200">?:</span> <span style="color:#d88200">/@/</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">confirmation</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:password</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">confirmation</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:terms_of_service</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:bool?</span><span style="color:#111">)</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:age</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:int?</span><span style="color:#111">,</span> <span style="color:#111">included_in?</span><span style="color:#111">:</span> <span style="color:#ae81ff">18</span><span style="color:#f92672">..</span><span style="color:#ae81ff">99</span><span style="color:#111">)</span>
          <span style="color:#111">optional</span><span style="color:#111">(</span><span style="color:#d88200">:avatar</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#111">size?</span><span style="color:#111">:</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#111">(</span><span style="color:#00a8c8">MEGABYTE</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span><span style="color:#111">))</span>
        <span style="color:#00a8c8">end</span>

        <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
          <span style="color:#00a8c8">if</span> <span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">valid?</span>
            <span style="color:#75715e"># ...</span>
          <span style="color:#00a8c8">else</span>
            <span style="color:#75715e"># ...</span>
          <span style="color:#00a8c8">end</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>Parameter validations are delegated, under the hood, to <a href="https://github.com/hanami/validations">Hanami::Validations</a>.
Please check the related documentation for a complete list of options and how to share code between validations.</p>

<h2 id="concrete-classes">Concrete Classes</h2>

<p>The params DSL is really quick and intuitive but it has the drawback that it can be visually noisy and makes it hard to unit test.
An alternative is to extract a class and pass it as an argument to <code>.params</code>.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/signup/my_params.rb</span>
<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Signup</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">MyParams</span> <span style="color:#f92672">&lt;</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Params</span>
        <span style="color:#00a8c8">MEGABYTE</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>

        <span style="color:#111">params</span> <span style="color:#00a8c8">do</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:name</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">)</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:email</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">,</span> <span style="color:#111">format</span><span style="color:#d88200">?:</span> <span style="color:#d88200">/@/</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">confirmation</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:password</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:str?</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">confirmation</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:terms_of_service</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:bool?</span><span style="color:#111">)</span>
          <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:age</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#d88200">:int?</span><span style="color:#111">,</span> <span style="color:#111">included_in?</span><span style="color:#111">:</span> <span style="color:#ae81ff">18</span><span style="color:#f92672">..</span><span style="color:#ae81ff">99</span><span style="color:#111">)</span>
          <span style="color:#111">optional</span><span style="color:#111">(</span><span style="color:#d88200">:avatar</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">filled</span><span style="color:#111">(</span><span style="color:#111">size?</span><span style="color:#111">:</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#111">(</span><span style="color:#00a8c8">MEGABYTE</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div><div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/signup/create.rb</span>
<span style="color:#111">require_relative</span> <span style="color:#d88200">&#39;./my_params&#39;</span>

<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Signup</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">Create</span>
        <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>
        <span style="color:#111">params</span> <span style="color:#00a8c8">MyParams</span>

        <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
          <span style="color:#00a8c8">if</span> <span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">valid?</span>
            <span style="color:#75715e"># ...</span>
          <span style="color:#00a8c8">else</span>
            <span style="color:#75715e"># ...</span>
          <span style="color:#00a8c8">end</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<h3 id="inline-predicates">Inline predicates</h3>

<p>In case there is a predicate that is needed only for the current params, you can define inline predicates:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/books/create.rb</span>

<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Books</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">Create</span>
        <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>

        <span style="color:#111">params</span> <span style="color:#00a8c8">Class</span><span style="color:#f92672">.</span><span style="color:#111">new</span><span style="color:#111">(</span><span style="color:#00a8c8">Hanami</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Params</span><span style="color:#111">)</span> <span style="color:#111">{</span>
          <span style="color:#111">predicate</span><span style="color:#111">(</span><span style="color:#d88200">:cool?</span><span style="color:#111">,</span> <span style="color:#d88200">message</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;is not cool&#34;</span><span style="color:#111">)</span> <span style="color:#00a8c8">do</span> <span style="color:#f92672">|</span><span style="color:#111">current</span><span style="color:#f92672">|</span>
            <span style="color:#111">current</span><span style="color:#f92672">.</span><span style="color:#111">match</span><span style="color:#111">(</span><span style="color:#d88200">/cool/</span><span style="color:#111">)</span>
          <span style="color:#00a8c8">end</span>

          <span style="color:#111">validations</span> <span style="color:#00a8c8">do</span>
            <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:book</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">schema</span> <span style="color:#00a8c8">do</span>
              <span style="color:#111">required</span><span style="color:#111">(</span><span style="color:#d88200">:title</span><span style="color:#111">)</span> <span style="color:#111">{</span> <span style="color:#111">filled?</span> <span style="color:#f92672">&amp;</span> <span style="color:#111">str?</span> <span style="color:#f92672">&amp;</span> <span style="color:#111">cool?</span> <span style="color:#111">}</span>
            <span style="color:#00a8c8">end</span>
          <span style="color:#00a8c8">end</span>
        <span style="color:#111">}</span>

        <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
          <span style="color:#00a8c8">if</span> <span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">valid?</span>
            <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">body</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;OK&#39;</span>
          <span style="color:#00a8c8">else</span>
            <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">body</span> <span style="color:#f92672">=</span> <span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">error_messages</span><span style="color:#f92672">.</span><span style="color:#111">join</span><span style="color:#111">(</span><span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">)</span>
          <span style="color:#00a8c8">end</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<h2 id="body-parsers">Body Parsers</h2>

<p>Rack ignores request bodies unless they come from a form submission.
If we have a JSON endpoint, the payload isn&rsquo;t available in <code>params</code>.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># apps/web/controllers/books/create.rb</span>

<span style="color:#00a8c8">module</span> <span style="color:#111">Web</span>
  <span style="color:#00a8c8">module</span> <span style="color:#111">Controllers</span>
    <span style="color:#00a8c8">module</span> <span style="color:#111">Books</span>
      <span style="color:#00a8c8">class</span> <span style="color:#75af00">Create</span>
        <span style="color:#00a8c8">include</span> <span style="color:#00a8c8">Web</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Action</span>
        <span style="color:#111">accept</span> <span style="color:#d88200">:json</span>

        <span style="color:#00a8c8">def</span> <span style="color:#75af00">call</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span>
          <span style="color:#111">puts</span> <span style="color:#111">params</span><span style="color:#f92672">.</span><span style="color:#111">to_h</span> <span style="color:#75715e"># =&gt; {}</span>
        <span style="color:#00a8c8">end</span>
      <span style="color:#00a8c8">end</span>
    <span style="color:#00a8c8">end</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div><div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl http://localhost:2300/books      <span style="color:#8045ff">\
</span><span style="color:#8045ff"></span>    -H <span style="color:#d88200">&#34;Content-Type: application/json&#34;</span> <span style="color:#8045ff">\
</span><span style="color:#8045ff"></span>    -H <span style="color:#d88200">&#34;Accept: application/json&#34;</span>       <span style="color:#8045ff">\
</span><span style="color:#8045ff"></span>    -d <span style="color:#d88200">&#39;{&#34;book&#34;:{&#34;title&#34;:&#34;Hanami&#34;}}&#39;</span>    <span style="color:#8045ff">\
</span><span style="color:#8045ff"></span>    -X POST</code></pre></div>
<p>In order to make book payload available in <code>params</code>, we should enable this feature:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># config/environment.rb</span>
<span style="color:#111">require</span> <span style="color:#d88200">&#34;hanami/middleware/body_parser&#34;</span>

<span style="color:#00a8c8">Hanami</span><span style="color:#f92672">.</span><span style="color:#111">configure</span> <span style="color:#00a8c8">do</span>
  <span style="color:#75715e"># ...</span>
  <span style="color:#111">middleware</span><span style="color:#f92672">.</span><span style="color:#111">use</span> <span style="color:#00a8c8">Hanami</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Middleware</span><span style="color:#f92672">::</span><span style="color:#00a8c8">BodyParser</span><span style="color:#111">,</span> <span style="color:#d88200">:json</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>Now <code>params.get(:book, :title)</code> returns <code>&quot;Hanami&quot;</code>.</p>

<p>In case there is no suitable body parser for your format in Hanami, it is possible to declare a new one:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># lib/foo_parser.rb</span>
<span style="color:#00a8c8">class</span> <span style="color:#75af00">FooParser</span>
  <span style="color:#00a8c8">def</span> <span style="color:#75af00">mime_types</span>
    <span style="color:#f92672">[</span><span style="color:#d88200">&#39;application/foo&#39;</span><span style="color:#f92672">]</span>
  <span style="color:#00a8c8">end</span>

  <span style="color:#00a8c8">def</span> <span style="color:#75af00">parse</span><span style="color:#111">(</span><span style="color:#111">body</span><span style="color:#111">)</span>
    <span style="color:#75715e"># manually parse body</span>
  <span style="color:#00a8c8">end</span>
<span style="color:#00a8c8">end</span></code></pre></div>
<p>and subsequently register it:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># config/environment.rb</span>
<span style="color:#111">require</span> <span style="color:#d88200">&#34;hanami/middleware/body_parser&#34;</span>

<span style="color:#00a8c8">Hanami</span><span style="color:#f92672">.</span><span style="color:#111">configure</span> <span style="color:#00a8c8">do</span>
  <span style="color:#75715e"># ...</span>
  <span style="color:#111">middleware</span><span style="color:#f92672">.</span><span style="color:#111">use</span> <span style="color:#00a8c8">Hanami</span><span style="color:#f92672">::</span><span style="color:#00a8c8">Middleware</span><span style="color:#f92672">::</span><span style="color:#00a8c8">BodyParser</span><span style="color:#111">,</span> <span style="color:#00a8c8">FooParser</span><span style="color:#f92672">.</span><span style="color:#111">new</span>
<span style="color:#00a8c8">end</span></code></pre></div><hr>
        <div class="container">
          <div class="row">
            <div class="col">
              
              <a href="/hanami-guides/actions/basic-usage/">
                <button class="btn btn-icon btn-3 btn-outline-primary" type="button">
                  <span class="btn-inner--icon"><i class="ni ni-bold-left"></i></span>
                  <span class="btn-inner--text">Actions: Basic Usage</span>
                </button>
              </a>
              
            </div>
            <div class="col text-align-right">
              
              <a href="/hanami-guides/actions/request-and-response/">
                <button class="btn btn-icon btn-3 btn-outline-primary" type="button">
                  <span class="btn-inner--text">Actions: Request &amp; Response</span>
                  <span class="btn-inner--icon"><i class="ni ni-bold-right"></i></span>
                </button>
              </a>
              
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <script src="/hanami-guides/assets/vendor/jquery/jquery.min.js"></script>
  <script src="/hanami-guides/assets/vendor/popper/popper.min.js"></script>
  <script src="/hanami-guides/assets/vendor/bootstrap/bootstrap.min.js"></script>
  <script src="/hanami-guides/assets/vendor/headroom/headroom.min.js"></script>
  <script src="/hanami-guides/assets/vendor/clipboard/clipboard.min.js"></script>
  
  <script src="/hanami-guides/assets/js/argon.js?v=1.0.1"></script>
  <script src="/hanami-guides/assets/js/theme.js"></script>
  
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
    apiKey: '69274449268769eb3878f6a13dd112f9',
    indexName: 'hanamirb_guides',
    inputSelector: '#search-input',
    debug: false 
  });
  </script>
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-41951932-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>
